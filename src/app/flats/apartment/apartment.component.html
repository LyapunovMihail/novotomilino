<div class="g-modal-bg apartment__modal" *ngIf="showApartmentWindow">

    <div class="apartment">

        <div class="apartment__elements">
            <div class="apartment__elements-btn apartment__elements-btn_prev" *ngIf="prevFlat && prevFlat.articleId">
                <button class="apartment__elements-prev" (click)="toPrevFlat()"></button>
                <p>№ {{prevFlat.flat}}</p>
            </div>
            <div class="apartment__elements-btn apartment__elements-btn_next" *ngIf="nextFlat && nextFlat.articleId">
                <button class="apartment__elements-next" (click)="toNextFlat()"></button>
                <p>№ {{nextFlat.flat}}</p>
            </div>
            <button class="apartment__elements-cls" (click)="close.emit(false)"></button>
            <!-- <div class="apartment__elements-compass">
                <img src="/assets/img/flats/apartment/compass.svg" alt="compass">
            </div> -->
        </div>

        <div class="apartment__info">
            <nav class="apartment__info-nav">
                <ul class="apartment__info-nav-list">
                    <li class="apartment__info-nav-item">
                        <a class="apartment__info-nav-item-link" [routerLink]="'/flats/plan'" (click)="close.emit(false)">Общий вид</a>
                    </li>
                    <li class="apartment__info-nav-item" [class.apartment__info-nav-item--underline]="typeApartment === 'flat'">
                        <ng-container *ngIf="typeApartment === 'flat'">
                            <a class="apartment__info-nav-item-link" [routerLink]="'/flats/house'" [queryParams]="{house: flatData.house}" (click)="close.emit(false)">Корпус {{flatData.house}}</a>
                        </ng-container>
                        <ng-container *ngIf="typeApartment === 'office'">Корпус {{flatData.house}}</ng-container>
                    </li>
                    <li class="apartment__info-nav-item">
                        Секция {{flatData.section}}
                    </li>
                    <li class="apartment__info-nav-item apartment__info-nav-item--underline">
                        <a class="apartment__info-nav-item-link" [routerLink]="'/flats' + (typeApartment === 'office' ? '/commercial' : '') + '/house/' + flatData.house + '/section/' + flatData.section + '/floor/' + flatData.floor" (click)="close.emit(false)">Этаж {{flatData.floor}}</a>
                    </li>
                    <li class="apartment__info-nav-item">{{typeApartment === 'flat' ? 'Квартира' : 'Помещение'}} №{{flatData.flat}}</li>
                </ul>
            </nav>

            <h1 class="apartment__info-title">
                {{apartamentRooms}}, №&nbsp;{{flatData.flat}}
            </h1>
            <div class="apartment__info-descr">
                <div class="apartment__info-descr-item" *ngIf="typeApartment === 'flat'">
                    <p class="apartment__info-subtitle">Отделка</p>
                    <p class="apartment__info-descr-value">{{flatData.decorationName}}</p>
                </div>
                <div class="apartment__info-descr-item">
                    <p class="apartment__info-subtitle">Площадь</p>
                    <p class="apartment__info-descr-value">{{flatData.space}} м<sup>2</sup></p>
                </div>
                <!-- <div class="apartment__info-descr-item">
                    <p class="apartment__info-subtitle">Ипотека от</p>
                    <p class="apartment__info-descr-value">{{ minCredit(flatData.price) | myBitNumberPipe }} &#8381;</p>
                </div> -->
                <div class="apartment__info-descr-item" *ngIf="typeApartment === 'office'">
                    <p class="apartment__info-subtitle">Цена за 1 м²</p>
                    <p class="apartment__info-descr-value">{{ (flatData.price / flatData.space).toFixed(2) | myBitNumberPipe }} &#8381;</p>
                </div>
            </div>
            <!--<div class="apartment__info-delivery">-->
                <!--Срок сдачи {{flatData.deliveryDate}}-->
            <!--</div>-->
            <div class="apartment__info-price">
                <p class="apartment__info-subtitle">Стоимость</p>
                <p class="apartment__info-price-value"
                    [class.apartment__info-price-value_not-sale]="flatData.discount">
                    {{flatData.price | myBitNumberPipe}} &#8381;
                </p>
                <p *ngIf="flatData.discount"
                    class="apartment__info-price-value apartment__info-price-value_sale">
                    {{flatData.price - flatData.discount | myBitNumberPipe}} &#8381;
                </p>
            </div>
            <p class="apartment__info-text" *ngIf="flatData.status === '1'">
                Квартира пока не в продаже. Вы можете забронировать ее на индивидуальных условиях, связавшись с менеджером отдела продаж
            </p>
            <div class="apartment__info-btn">
                <button (click)="isReserveFormOpen = true;" class="apartment__info-btn-reserve">
                    Забронировать
                </button>
                <button (click)="isCreditFormOpen = true;" class="apartment__info-btn-credit">
                    Заявка на ипотеку
                </button>
            </div>
        </div>

        <div class="apartment__plan">
            <div class="apartment__plan-link">
                <!-- Скрыл для офисов потому что не выводит планировку для офисных помещений, нужно доработать -->
                <a class="g-link_red apartment__plan-link-dwnld" (click)="routePDF()" target="_blank" *ngIf="typeApartment === 'flat'"
                    [class.clicked]="clickedPdf">{{typeApartment === 'flat' ? 'План квартиры' : 'План помещения'}}.pdf</a>
                <div (click)="setFavorite()"
                     [ngClass]="{'apartment__plan-link-favorite_active': flatData.inFavorite}"
                     class="g-link_red apartment__plan-link-favorite">
                        Добавить в избранное
                </div>
            </div>
            <div class="apartment__plan-img">
                <img class="apartment_item_scheme" (error)="img.style.display = 'none'"
                     [src]="'/assets/floor-plans/house_' + flatData.house + '/section_' + flatData.section + '/floor_' + flatData.floor + '/' + flatData.floor + 'floor_' + flatData.flat + typeApartment + '.svg'" alt="" #img>
                <div *ngIf="img.style.display === 'none'" class="apartment__plan-img-error">Изображение недоступно</div>
            </div>
        </div>

    </div>
</div>

<app-form-credit *ngIf="flatData"
    (close)="isCreditFormOpen = $event"
    [isOpen]="isCreditFormOpen"
    (isSubmited)="isFormSuccessOpen = $event"
    [apartmentPrice]="flatData.price"
    [apartmentNumber]="flatData.flat"
    [type]="flatData.type"
    [articleId]="flatData.articleId">
</app-form-credit>
<app-form-reserve *ngIf="flatData"
    (close)="isReserveFormOpen = $event"
    [isOpen]="isReserveFormOpen"
    (isSubmited)="isFormSuccessOpen = $event"
    [apartmentPrice]="flatData.price"
    [apartmentNumber]="flatData.flat"
    [type]="flatData.type"
    [articleId]="flatData.articleId">
</app-form-reserve>

<app-form-success *ngIf="flatData"
    (close)="isFormSuccessOpen = $event"
    [isOpen]="isFormSuccessOpen">
</app-form-success>


